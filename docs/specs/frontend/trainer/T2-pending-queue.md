# æ¨¡å—å¼€å‘è§„æ ¼ä¹¦ï¼šT2 å¾…å¤„ç†é˜Ÿåˆ—ç»„ä»¶

## æ–‡æ¡£ä¿¡æ¯
| é¡¹ç›® | å†…å®¹ |
|-----|------|
| æ¨¡å—ID | T2 |
| æ¨¡å—åç§° | å¾…å¤„ç†é˜Ÿåˆ—ç»„ä»¶ |
| ç‰ˆæœ¬ | 1.0 |
| æ—¥æœŸ | 2026å¹´1æœˆ |
| çŠ¶æ€ | å¾…å¼€å‘ |
| å‰ç½®ä¾èµ– | G5 Agentäº¤äº’API |

---

## 1. æ¨¡å—æ¦‚è¿°

### 1.1 èŒè´£æè¿°
å¾…å¤„ç†é˜Ÿåˆ—ç»„ä»¶å±•ç¤ºéœ€è¦è®­ç»ƒå¸ˆäººå·¥å¤„ç†çš„äº‹é¡¹ï¼ˆå¼‚å¸¸å‡çº§ã€å†³ç­–ç¡®è®¤ç­‰ï¼‰ï¼Œæ”¯æŒå¿«é€Ÿå¤„ç†å’Œæ‰¹é‡æ“ä½œã€‚

### 1.2 åŠŸèƒ½æ¦‚è¿°
- å±•ç¤ºå¾…å¤„ç†äº‹é¡¹åˆ—è¡¨
- æŒ‰ä¼˜å…ˆçº§æ’åºå’Œç­›é€‰
- ä¸€é”®å¤„ç†/æ‰¹é‡å¤„ç†
- è¿‡æœŸæé†’
- å¤„ç†å†å²è®°å½•

---

## 2. UIè®¾è®¡

### 2.1 ç»„ä»¶å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¾…å¤„ç†é˜Ÿåˆ—                           [æ‰¹é‡å¤„ç†] [åˆ·æ–°] ğŸ”” 3  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€ ç»Ÿè®¡æ  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ ğŸ”´ ç´§æ€¥: 1    ğŸŸ  é«˜: 2    ğŸŸ¡ ä¸­: 3    ğŸŸ¢ ä½: 1           â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€ å¾…å¤„ç†åˆ—è¡¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ â˜ ğŸ”´ æœºå™¨äººæ•…éšœéœ€å¤„ç†                     â° è¿˜å‰©15åˆ†é’Ÿ  â”‚â”‚
â”‚ â”‚    robot_003æŠ¥å‘Šç”µæœºè¿‡çƒ­ï¼Œéœ€è¦äººå·¥ç¡®è®¤                    â”‚â”‚
â”‚ â”‚    [ç«‹å³è¿”å›å……ç”µ] [æ´¾äººæ£€æŸ¥] [æš‚æ—¶å¿½ç•¥]                   â”‚â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚â”‚
â”‚ â”‚ â˜ ğŸŸ  ä»»åŠ¡è°ƒåº¦ç¡®è®¤                         â° è¿˜å‰©45åˆ†é’Ÿ  â”‚â”‚
â”‚ â”‚    Agentå»ºè®®è°ƒæ•´æ¸…æ´é¡ºåºä»¥ä¼˜åŒ–ç”µé‡ä½¿ç”¨                    â”‚â”‚
â”‚ â”‚    [æ‰¹å‡†è°ƒæ•´] [ä¿æŒåŸè®¡åˆ’] [æŸ¥çœ‹è¯¦æƒ…]                     â”‚â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚â”‚
â”‚ â”‚ â˜ ğŸŸ¡ è¦†ç›–ç‡å¼‚å¸¸                           â° è¿˜å‰©2å°æ—¶   â”‚â”‚
â”‚ â”‚    3Fèµ°å»ŠåŒºåŸŸæœ¬å‘¨è¦†ç›–ç‡ä»…65%ï¼Œä½äºç›®æ ‡                    â”‚â”‚
â”‚ â”‚    [å¢åŠ æ¸…æ´é¢‘æ¬¡] [è°ƒæ•´ä»»åŠ¡] [æ ‡è®°å·²çŸ¥]                   â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚ â”Œâ”€ å·²å¤„ç† (ä»Šæ—¥) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ [å±•å¼€] â”â”‚
â”‚ â”‚ âœ“ å·²å¤„ç† 5 é¡¹                                            â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å¾…å¤„ç†å¡ç‰‡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â˜  ğŸ”´ ç´§æ€¥                                    â° è¿˜å‰©15åˆ†é’Ÿâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ¤– æœºå™¨äººæ•…éšœéœ€å¤„ç†                                        â”‚
â”‚                                                            â”‚
â”‚ robot_003(æ¸…æ´æœºå™¨äºº3å·)æŠ¥å‘Šç”µæœºè¿‡çƒ­é”™è¯¯                    â”‚
â”‚ å½“å‰ä½ç½®: Aåº§3Fèµ°å»Š                                        â”‚
â”‚ å‘ç”Ÿæ—¶é—´: 10:25                                            â”‚
â”‚                                                            â”‚
â”‚ â”Œâ”€ Agentå»ºè®® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ å»ºè®®ç«‹å³åœæ­¢å·¥ä½œå¹¶è¿”å›å……ç”µç«™è¿›è¡Œæ£€æŸ¥                   â”‚  â”‚
â”‚ â”‚ ç½®ä¿¡åº¦: 92%                                           â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                            â”‚
â”‚ [ğŸ”™ ç«‹å³è¿”å›å……ç”µ]  [ğŸ‘· æ´¾äººæ£€æŸ¥]  [â¸ï¸ æš‚åœè§‚å¯Ÿ]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ç»„ä»¶æ¥å£

### 3.1 Propså®šä¹‰
```typescript
interface PendingQueueProps {
  tenantId: string;
  // è‡ªåŠ¨åˆ·æ–°é—´éš”ï¼ˆç§’ï¼‰ï¼Œ0è¡¨ç¤ºç¦ç”¨
  refreshInterval?: number;  // default: 30
  // å¤„ç†å®Œæˆå›è°ƒ
  onItemResolved?: (item: PendingItem, action: string) => void;
  // è¶…æ—¶è­¦å‘Šå›è°ƒ
  onExpirationWarning?: (item: PendingItem) => void;
}
```

### 3.2 æ•°æ®ç±»å‹
```typescript
interface PendingItem {
  itemId: string;
  type: 'escalation' | 'confirmation' | 'alert';
  priority: 'low' | 'medium' | 'high' | 'critical';
  status: 'pending' | 'in_progress' | 'resolved' | 'expired';
  title: string;
  description: string;
  agentType: string;
  relatedEntities: {
    robotId?: string;
    taskId?: string;
    zoneId?: string;
  };
  suggestedActions: SuggestedAction[];
  createdAt: string;
  expiresAt?: string;
}

interface SuggestedAction {
  action: string;
  label: string;
  variant?: 'primary' | 'secondary' | 'danger';
  params?: Record<string, any>;
}
```

### 3.3 APIè°ƒç”¨
```typescript
// è·å–å¾…å¤„ç†åˆ—è¡¨
GET /api/v1/agents/pending-items
  ?tenant_id={tenantId}
  &status=pending
  &limit=50

// å¤„ç†äº‹é¡¹
POST /api/v1/agents/pending-items/{itemId}/resolve
  body: { action: string, comment?: string, params?: object }
```

---

## 4. å®ç°è¦æ±‚

### 4.1 æŠ€æœ¯æ ˆ
- React 18+ / TypeScript
- TailwindCSS
- React Query
- date-fns (æ—¶é—´å¤„ç†)

### 4.2 æ ¸å¿ƒå®ç°
```typescript
// components/PendingQueue/index.tsx
export const PendingQueue: React.FC<PendingQueueProps> = ({
  tenantId,
  refreshInterval = 30,
  onItemResolved,
  onExpirationWarning
}) => {
  const [selectedItems, setSelectedItems] = useState<Set<string>>(new Set());
  
  const { data, refetch } = useQuery({
    queryKey: ['pending-items', tenantId],
    queryFn: () => fetchPendingItems(tenantId),
    refetchInterval: refreshInterval * 1000
  });
  
  const resolveMutation = useMutation({
    mutationFn: resolveItem,
    onSuccess: (_, { itemId, action }) => {
      queryClient.invalidateQueries(['pending-items']);
      onItemResolved?.(data?.items.find(i => i.itemId === itemId)!, action);
    }
  });
  
  // è¿‡æœŸæ£€æŸ¥
  useEffect(() => {
    const checkExpiration = () => {
      data?.items.forEach(item => {
        if (item.expiresAt) {
          const remaining = new Date(item.expiresAt).getTime() - Date.now();
          if (remaining < 5 * 60 * 1000 && remaining > 0) {  // 5åˆ†é’Ÿå†…
            onExpirationWarning?.(item);
          }
        }
      });
    };
    const interval = setInterval(checkExpiration, 60000);
    return () => clearInterval(interval);
  }, [data]);
  
  return (
    <div className="flex flex-col h-full">
      <PriorityStats items={data?.items || []} />
      <PendingList 
        items={data?.items || []}
        selectedItems={selectedItems}
        onSelect={setSelectedItems}
        onResolve={(itemId, action) => resolveMutation.mutate({ itemId, action })}
      />
    </div>
  );
};
```

### 4.3 å€’è®¡æ—¶æ˜¾ç¤º
```typescript
const ExpirationTimer: React.FC<{ expiresAt: string }> = ({ expiresAt }) => {
  const [remaining, setRemaining] = useState(
    new Date(expiresAt).getTime() - Date.now()
  );
  
  useEffect(() => {
    const interval = setInterval(() => {
      setRemaining(new Date(expiresAt).getTime() - Date.now());
    }, 1000);
    return () => clearInterval(interval);
  }, [expiresAt]);
  
  if (remaining <= 0) return <span className="text-red-600">å·²è¿‡æœŸ</span>;
  
  const minutes = Math.floor(remaining / 60000);
  const hours = Math.floor(minutes / 60);
  
  const color = minutes < 15 ? 'text-red-600' : 
                minutes < 60 ? 'text-yellow-600' : 'text-gray-600';
  
  return (
    <span className={color}>
      â° è¿˜å‰©{hours > 0 ? `${hours}å°æ—¶` : `${minutes}åˆ†é’Ÿ`}
    </span>
  );
};
```

---

## 5. æµ‹è¯•è¦æ±‚

### 5.1 å•å…ƒæµ‹è¯•
```typescript
describe('PendingQueue', () => {
  it('displays pending items sorted by priority', async () => {
    render(<PendingQueue tenantId="tenant_001" />);
    await waitFor(() => {
      const items = screen.getAllByRole('listitem');
      // éªŒè¯criticalåœ¨å‰
    });
  });
  
  it('resolves item on action click', async () => {
    const onResolved = jest.fn();
    render(<PendingQueue tenantId="tenant_001" onItemResolved={onResolved} />);
    
    await userEvent.click(screen.getByText('ç«‹å³è¿”å›å……ç”µ'));
    
    await waitFor(() => {
      expect(onResolved).toHaveBeenCalled();
    });
  });
  
  it('shows expiration warning', async () => {
    const onWarning = jest.fn();
    render(<PendingQueue tenantId="tenant_001" onExpirationWarning={onWarning} />);
    
    // æ¨¡æ‹Ÿæ—¶é—´æµé€
    jest.advanceTimersByTime(60000);
    
    expect(onWarning).toHaveBeenCalled();
  });
});
```

---

## 6. éªŒæ”¶æ ‡å‡†

### 6.1 åŠŸèƒ½éªŒæ”¶
- [ ] å¾…å¤„ç†åˆ—è¡¨æ­£ç¡®æ˜¾ç¤º
- [ ] æŒ‰ä¼˜å…ˆçº§æ’åºæ­£ç¡®
- [ ] å€’è®¡æ—¶æ˜¾ç¤ºæ­£ç¡®
- [ ] å¤„ç†æ“ä½œæ­£å¸¸æ‰§è¡Œ
- [ ] æ‰¹é‡å¤„ç†åŠŸèƒ½æ­£å¸¸
- [ ] è‡ªåŠ¨åˆ·æ–°æ­£å¸¸

### 6.2 æ€§èƒ½è¦æ±‚
- åˆ—è¡¨æ¸²æŸ“ < 100ms
- å¤„ç†å“åº” < 500ms
